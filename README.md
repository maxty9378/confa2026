# Опрос для региональной конференции (Next.js)

Сервис для опроса на презентации: участники переходят по QR-коду, **сначала выбирают роль** (ГДф или СВ), затем отвечают на вопрос «Насколько вы владеете стандартами СПП?» (10–100%). На отдельной странице в реальном времени выводится среднее значение.

## Стек

- **Next.js 15** (App Router), React 19, TypeScript
- **Directus** — хранение голосов ([https://apidoirp.ru/](https://apidoirp.ru/))
- Онлайн-обновление дашборда через **Server-Sent Events (SSE)**

## Directus

Голоса сохраняются в коллекции **`votes`**. Таблицу можно создать вручную в Data Studio или **автоматически**:

```bash
npm run setup:directus
```

Скрипт создаёт коллекцию **votes** с полями **role** (string) и **value** (integer). Нужен токен с правами администратора. Если коллекция уже есть, скрипт просто сообщит об этом.

Переменные окружения (файл `.env.local`, не коммитить):

```env
DIRECTUS_URL=https://apidoirp.ru/
DIRECTUS_TOKEN=ваш_статический_токен
```

См. `.env.example`.

## Запуск

```bash
npm install
npm run dev
```

- **Опрос (QR → сюда):** http://localhost:3000/
- **Дашборд (экран/проектор):** http://localhost:3000/dashboard

Продакшен:

```bash
npm run build
npm start
```

## Сценарий

1. **Шаг 1:** «Выберите свою роль» — кнопки ГДф и СВ.
2. **Шаг 2:** Вопрос про владение стандартами СПП — слайдер 10–100% и ручной ввод.
3. После отправки — «Спасибо! Ваш ответ учтён.»

Дашборд показывает среднее по всем, по ГДф и по СВ и обновляется в реальном времени при каждом новом голосе. Сверху выводятся два блока: **«Так вы считаете»** (среднее по опросу) и **«Результаты тестирования»** (значение, которое задаётся в админке).

## Админка

**http://localhost:3000/admin** — страница для ввода результата тестирования по курсам (0–100%). Это значение отображается на дашборде рядом с самооценкой участников. Коллекция в Directus: **confa_settings** (создать: `npm run setup:directus:settings`).
